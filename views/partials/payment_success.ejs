<div class="fixed inset-0 flex items-center justify-center z-50 p-4" id="successNotification">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" 
         onclick="closeNotification()"
         id="notificationBackdrop"></div>
    
    <!-- Success Modal -->
    <div class="relative glass-card max-w-md w-full transform transition-all duration-500 ease-out scale-95 opacity-0" 
         id="successModal">
        
        <!-- Confetti Animation -->
        <div class="absolute inset-0 pointer-events-none overflow-hidden rounded-3xl">
            <div class="confetti-container">
                <div class="confetti confetti-1"></div>
                <div class="confetti confetti-2"></div>
                <div class="confetti confetti-3"></div>
                <div class="confetti confetti-4"></div>
                <div class="confetti confetti-5"></div>
                <div class="confetti confetti-6"></div>
                <div class="confetti confetti-7"></div>
                <div class="confetti confetti-8"></div>
                <div class="confetti confetti-9"></div>
                <div class="confetti confetti-10"></div>
            </div>
        </div>
        
        <!-- Success Content -->
        <div class="relative p-8 text-center">
            <!-- Success Icon with Animation -->
            <div class="success-icon-container mb-6">
                <div class="success-icon">
                    <div class="checkmark-circle">
                        <div class="checkmark"></div>
                    </div>
                </div>
            </div>
            
            <!-- Success Title -->
            <h3 class="success-title mb-4">
                üéâ Thanh to√°n th√†nh c√¥ng!
            </h3>
            
            <!-- Success Message -->
            <div class="success-message mb-6">
                <p class="text-gray-600 leading-relaxed">
                    Ch√∫c m·ª´ng! B·∫°n ƒë√£ ƒëƒÉng k√Ω th√†nh c√¥ng kh√≥a h·ªçc. 
                    <br>
                    <span class="font-semibold text-primary">H√£y b·∫Øt ƒë·∫ßu h√†nh tr√¨nh h·ªçc t·∫≠p ngay th√¥i!</span>
                </p>
            </div>
            
            <!-- Course Info (if available) -->
            <% if (typeof course !== 'undefined' && course) { %>
                <div class="course-info mb-6">
                    <div class="course-card">
                        <div class="course-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="course-details">
                            <h4 class="course-title"><%= course.title %></h4>
                            <p class="course-instructor">Gi·∫£ng vi√™n: <%= course.instructor.fullName %></p>
                        </div>
                    </div>
                </div>
            <% } %>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button onclick="startLearning()" 
                        class="btn-primary mb-3">
                    <i class="fas fa-play-circle mr-2"></i>
                    B·∫Øt ƒë·∫ßu h·ªçc ngay
                </button>
                
                <button onclick="closeNotification()" 
                        class="btn-secondary">
                    <i class="fas fa-times mr-2"></i>
                    ƒê√≥ng th√¥ng b√°o
                </button>
            </div>
            
            <!-- Progress Bar -->
            <div class="progress-container mt-6">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p class="progress-text">
                    T·ª± ƒë·ªông ƒë√≥ng sau <span id="countdown">8</span> gi√¢y
                </p>
            </div>
        </div>
        
        <!-- Close Button -->
        <button onclick="closeNotification()" 
                class="close-btn">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>

<style>
    .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 24px;
        box-shadow: 
            0 25px 80px rgba(0, 0, 0, 0.1),
            0 0 0 1px rgba(255, 255, 255, 0.1) inset;
        position: relative;
        overflow: hidden;
    }
    
    .success-icon-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 120px;
    }
    
    .success-icon {
        width: 100px;
        height: 100px;
        position: relative;
        animation: bounceIn 0.8s ease-out 0.3s both;
    }
    
    .checkmark-circle {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(135deg, #10b981, #34d399);
        position: relative;
        box-shadow: 0 15px 40px rgba(16, 185, 129, 0.3);
        animation: pulse 2s ease-in-out infinite;
    }
    
    .checkmark {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 24px;
        height: 12px;
        border: 3px solid white;
        border-top: none;
        border-right: none;
        transform: translate(-50%, -60%) rotate(-45deg);
        animation: checkmarkDraw 0.5s ease-out 0.8s both;
    }
    
    .success-title {
        font-size: 28px;
        font-weight: 700;
        color: #1f2937;
        animation: slideUp 0.6s ease-out 0.5s both;
    }
    
    .success-message {
        animation: slideUp 0.6s ease-out 0.7s both;
    }
    
    .course-info {
        animation: slideUp 0.6s ease-out 0.9s both;
    }
    
    .course-card {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
        border: 2px solid rgba(102, 126, 234, 0.1);
        border-radius: 16px;
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 16px;
        transition: all 0.3s ease;
    }
    
    .course-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.1);
    }
    
    .course-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 18px;
        flex-shrink: 0;
    }
    
    .course-details {
        flex: 1;
        text-align: left;
    }
    
    .course-title {
        font-size: 16px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 4px;
    }
    
    .course-instructor {
        font-size: 14px;
        color: #6b7280;
    }
    
    .action-buttons {
        animation: slideUp 0.6s ease-out 1.1s both;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #10b981, #34d399);
        color: white;
        font-weight: 600;
        padding: 12px 24px;
        border-radius: 16px;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);
    }
    
    .btn-secondary {
        background: rgba(107, 114, 128, 0.1);
        color: #6b7280;
        font-weight: 500;
        padding: 10px 20px;
        border-radius: 12px;
        border: 2px solid rgba(107, 114, 128, 0.2);
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 100%;
    }
    
    .btn-secondary:hover {
        background: rgba(107, 114, 128, 0.15);
        border-color: rgba(107, 114, 128, 0.3);
        transform: translateY(-1px);
    }
    
    .close-btn {
        position: absolute;
        top: 16px;
        right: 16px;
        width: 40px;
        height: 40px;
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .close-btn:hover {
        background: rgba(239, 68, 68, 0.2);
        transform: scale(1.1);
    }
    
    .progress-container {
        animation: slideUp 0.6s ease-out 1.3s both;
    }
    
    .progress-bar {
        width: 100%;
        height: 4px;
        background: rgba(107, 114, 128, 0.2);
        border-radius: 2px;
        overflow: hidden;
        margin-bottom: 8px;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #10b981, #34d399);
        border-radius: 2px;
        transition: width 0.1s linear;
        width: 100%;
    }
    
    .progress-text {
        font-size: 12px;
        color: #6b7280;
        margin: 0;
    }
    
    /* Confetti Animations */
    .confetti-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }
    
    .confetti {
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        animation: confettiFall 3s ease-out infinite;
    }
    
    .confetti-1 { background: #10b981; left: 10%; animation-delay: 0s; }
    .confetti-2 { background: #3b82f6; left: 20%; animation-delay: 0.3s; }
    .confetti-3 { background: #f59e0b; left: 30%; animation-delay: 0.6s; }
    .confetti-4 { background: #8b5cf6; left: 40%; animation-delay: 0.9s; }
    .confetti-5 { background: #ef4444; left: 50%; animation-delay: 1.2s; }
    .confetti-6 { background: #06b6d4; left: 60%; animation-delay: 0.2s; }
    .confetti-7 { background: #84cc16; left: 70%; animation-delay: 0.5s; }
    .confetti-8 { background: #f97316; left: 80%; animation-delay: 0.8s; }
    .confetti-9 { background: #ec4899; left: 90%; animation-delay: 1.1s; }
    .confetti-10 { background: #6366f1; left: 15%; animation-delay: 1.4s; }
    
    /* Animations */
    @keyframes bounceIn {
        0% {
            opacity: 0;
            transform: scale(0.3) rotate(-360deg);
        }
        50% {
            opacity: 1;
            transform: scale(1.05) rotate(-180deg);
        }
        70% {
            transform: scale(0.9) rotate(-90deg);
        }
        100% {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }
    }
    
    @keyframes checkmarkDraw {
        0% {
            width: 0;
            height: 0;
        }
        50% {
            width: 24px;
            height: 0;
        }
        100% {
            width: 24px;
            height: 12px;
        }
    }
    
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes pulse {
        0%, 100% {
            transform: scale(1);
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.3);
        }
        50% {
            transform: scale(1.05);
            box-shadow: 0 20px 50px rgba(16, 185, 129, 0.4);
        }
    }
    
    @keyframes confettiFall {
        0% {
            transform: translateY(-100px) rotate(0deg);
            opacity: 1;
        }
        100% {
            transform: translateY(400px) rotate(360deg);
            opacity: 0;
        }
    }
    
    @keyframes modalShow {
        from {
            opacity: 0;
            transform: scale(0.8) translateY(20px);
        }
        to {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }
    
    @keyframes modalHide {
        from {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
        to {
            opacity: 0;
            transform: scale(0.8) translateY(20px);
        }
    }
    
    /* Responsive */
    @media (max-width: 640px) {
        .glass-card {
            margin: 16px;
            border-radius: 20px;
        }
        
        .success-title {
            font-size: 24px;
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
        }
        
        .checkmark-circle {
            width: 80px;
            height: 80px;
        }
        
        .course-card {
            padding: 12px;
            gap: 12px;
        }
        
        .course-icon {
            width: 40px;
            height: 40px;
            font-size: 16px;
        }
        
        .course-title {
            font-size: 14px;
        }
        
        .course-instructor {
            font-size: 12px;
        }
    }
    
    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
        .glass-card {
            background: rgba(31, 41, 55, 0.95);
            border-color: rgba(75, 85, 99, 0.3);
        }
        
        .success-title {
            color: #f9fafb;
        }
        
        .success-message p {
            color: #d1d5db;
        }
        
        .course-title {
            color: #f9fafb;
        }
        
        .course-instructor {
            color: #9ca3af;
        }
        
        .progress-text {
            color: #9ca3af;
        }
    }
</style>

<script>
let countdown = 8;
let countdownInterval;
let progressInterval;

function initializeNotification() {
    const modal = document.getElementById('successModal');
    const notification = document.getElementById('successNotification');
    
    // Show modal with animation
    setTimeout(() => {
        modal.style.opacity = '1';
        modal.style.transform = 'scale(1)';
    }, 100);
    
    // Start countdown
    startCountdown();
    
    // Start progress bar animation
    startProgressBar();
    
    // Play success sound (if available)
    playSuccessSound();
}

function startCountdown() {
    const countdownElement = document.getElementById('countdown');
    
    countdownInterval = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
            closeNotification();
        }
    }, 1000);
}

function startProgressBar() {
    const progressFill = document.getElementById('progressFill');
    let width = 100;
    const decrement = 100 / (countdown * 10); // Update every 100ms
    
    progressInterval = setInterval(() => {
        width -= decrement;
        if (width <= 0) {
            width = 0;
            clearInterval(progressInterval);
        }
        progressFill.style.width = width + '%';
    }, 100);
}

function closeNotification() {
    const modal = document.getElementById('successModal');
    const notification = document.getElementById('successNotification');
    
    // Clear intervals
    if (countdownInterval) clearInterval(countdownInterval);
    if (progressInterval) clearInterval(progressInterval);
    
    // Hide with animation
    modal.style.animation = 'modalHide 0.3s ease-out forwards';
    
    setTimeout(() => {
        notification.style.display = 'none';
        
        // Clean up
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 300);
}

function startLearning() {
    // Close notification first
    closeNotification();
    
    // Redirect to course or dashboard
    <% if (typeof course !== 'undefined' && course) { %>
        window.location.href = '/courses/<%= course._id %>';
    <% } else { %>
        window.location.href = '/student/dashboard';
    <% } %>
}

function playSuccessSound() {
    // Create audio context for success sound
    if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
        try {
            const audioContext = new (AudioContext || webkitAudioContext)();
            
            // Create success sound
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        } catch (error) {
            console.log('Audio not supported');
        }
    }
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    initializeNotification();
});

// Handle escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeNotification();
    }
});

// Prevent closing when clicking on modal content
document.getElementById('successModal').addEventListener('click', function(e) {
    e.stopPropagation();
});

// Handle window blur/focus for countdown
let wasBlurred = false;

window.addEventListener('blur', function() {
    wasBlurred = true;
    if (countdownInterval) clearInterval(countdownInterval);
    if (progressInterval) clearInterval(progressInterval);
});

window.addEventListener('focus', function() {
    if (wasBlurred) {
        wasBlurred = false;
        // Resume countdown if modal is still visible
        const notification = document.getElementById('successNotification');
        if (notification && notification.style.display !== 'none') {
            startCountdown();
            startProgressBar();
        }
    }
});
</script>