<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= course.title %> - Danh sách lớp học</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }
        
        .slide-in {
            animation: slideIn 0.6s ease-out forwards;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            margin-bottom: 24px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .course-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }
        
        .course-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        .class-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .class-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.15);
        }
        
        .class-header {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            padding: 24px;
            position: relative;
        }
        
        .class-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        .teacher-info {
            display: flex;
            align-items: center;
            margin-top: 12px;
            padding: 8px 0;
        }
        
        .teacher-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-right: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .progress-section {
            margin-top: 20px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 8px;
            transition: all 1s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .class-details {
            padding: 24px;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
        }
        
        .detail-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }
        
        .detail-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            margin-right: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .icon-calendar {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
        }
        
        .icon-end {
            background: linear-gradient(135deg, #10b981, #34d399);
        }
        
        .icon-clock {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
        }
        
        .icon-users {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
        }
        
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .status-badge::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }
        
        .status-badge:hover::before {
            width: 200%;
            height: 200%;
        }
        
        .status-completed {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(52, 211, 153, 0.1));
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .status-upcoming {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.1));
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        
        .status-ongoing {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(96, 165, 250, 0.1));
            color: #2563eb;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .enrollment-section {
            border-top: 2px solid rgba(102, 126, 234, 0.1);
            padding-top: 20px;
            margin-top: 20px;
        }
        
        .enrollment-status {
            padding: 16px;
            border-radius: 12px;
            border: 2px solid;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        
        .enrollment-enrolled {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(52, 211, 153, 0.1));
            border-color: rgba(16, 185, 129, 0.3);
            color: #059669;
        }
        
        .enrollment-pending {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.1));
            border-color: rgba(245, 158, 11, 0.3);
            color: #d97706;
        }
        
        .enrollment-rejected {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(248, 113, 113, 0.1));
            border-color: rgba(239, 68, 68, 0.3);
            color: #dc2626;
        }
        
        .btn-3d {
            position: relative;
            transform-style: preserve-3d;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .btn-3d::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.4s ease;
            transform: translate(-50%, -50%);
        }
        
        .btn-3d:hover::before {
            width: 200%;
            height: 200%;
        }
        
        .btn-3d:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            text-decoration: none;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover {
            color: white;
            text-decoration: none;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .btn-secondary {
            background: rgba(107, 114, 128, 0.1);
            color: #374151;
            border: 2px solid rgba(107, 114, 128, 0.2);
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: rgba(107, 114, 128, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 114, 128, 0.2);
            text-decoration: none;
            color: #374151;
        }
        
        .btn-join {
            background: linear-gradient(135deg, #10b981, #34d399);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-join:hover {
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }
        
        .btn-enter {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-enter:hover {
            color: white;
            text-decoration: none;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 40px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
        }
        
        .empty-icon {
            font-size: 80px;
            color: #d1d5db;
            margin-bottom: 24px;
            animation: float 3s ease-in-out infinite;
        }
        
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981, #34d399);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444, #f87171);
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .pulse-animation {
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @media (max-width: 768px) {
            .course-header {
                margin: 16px;
                border-radius: 20px;
            }
            
            .class-card {
                margin: 16px;
                border-radius: 20px;
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .class-header {
                padding: 16px;
            }
            
            .class-details {
                padding: 16px;
            }
            
            .btn-primary,
            .btn-secondary,
            .btn-join {
                width: 100%;
                justify-content: center;
                margin: 8px 0;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen">
    <div class="flex h-screen">
        <!-- Include Student Sidebar -->
        <%- include('../partials/student_sidebar', { 
            user: locals.user, 
            path: '/courses' 
        }) %>

        <div class="flex-1 flex flex-col overflow-hidden">
            <%- include('../partials/dashboards_header') %>

            <main class="flex-1 overflow-x-hidden overflow-y-auto">
                <div class="container mx-auto px-4 py-8">
                    <!-- Hero Section -->
                    <div class="text-center mb-8 slide-in">
                        <div class="header-icon floating-animation mx-auto">
                            <i class="fas fa-school"></i>
                        </div>
                        <h1 class="text-4xl font-bold gradient-text mb-4">Danh sách lớp học</h1>
                        <p class="text-xl text-gray-600">Chọn lớp học phù hợp với lịch của bạn</p>
                    </div>

                    <!-- Course Header -->
                    <div class="course-header slide-in fade-in card-hover mb-8">
                        <div class="p-8">
                            <div class="flex flex-col md:flex-row justify-between items-start">
                                <div class="flex-1">
                                    <h2 class="text-3xl font-bold text-gray-800 mb-4">
                                        <i class="fas fa-graduation-cap mr-3 text-purple-500"></i>
                                        <%= course.title %>
                                    </h2>
                                    <p class="text-gray-600 text-lg mb-6">
                                        <%= course.description || 'Khóa học Korean chất lượng cao với phương pháp giảng dạy hiện đại' %>
                                    </p>
                                    <div class="flex items-center space-x-6 text-sm text-gray-500">
                                        <div class="flex items-center">
                                            <i class="fas fa-clock mr-2 text-blue-500"></i>
                                            <span><%= course.duration || '12 tuần' %></span>
                                        </div>
                                        <div class="flex items-center">
                                            <i class="fas fa-signal mr-2 text-green-500"></i>
                                            <span><%= course.level || 'Beginner' %></span>
                                        </div>
                                        <div class="flex items-center">
                                            <i class="fas fa-users mr-2 text-purple-500"></i>
                                            <span><%= classes.length %> lớp học</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 md:mt-0">
                                    <a href="/student/my-courses" 
                                       class="btn-secondary btn-3d">
                                        <i class="fas fa-arrow-left mr-2"></i>
                                        Quay lại khóa học
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Classes Grid -->
                    <% if (classes.length === 0) { %>
                        <div class="class-card slide-in fade-in">
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="fas fa-chalkboard-teacher"></i>
                                </div>
                                <h3 class="text-2xl font-bold text-gray-600 mb-4">Chưa có lớp học nào</h3>
                                <p class="text-gray-500 text-lg mb-6">
                                    Hiện tại chưa có lớp học nào được mở cho khóa học này.
                                </p>
                                <a href="/student/my-courses" class="btn-primary btn-3d">
                                    <i class="fas fa-arrow-left mr-2"></i>
                                    Quay lại khóa học
                                </a>
                            </div>
                        </div>
                    <% } else { %>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <% classes.forEach((classItem, index) => { %>
                                <div class="class-card slide-in fade-in card-hover" 
                                     style="animation-delay: <%= index * 0.1 %>s;">
                                    <!-- Class Header -->
                                    <div class="class-header">
                                        <div class="flex items-center justify-between mb-4">
                                            <h3 class="text-2xl font-bold text-gray-800">
                                                <%= classItem.name %>
                                            </h3>
                                            <% const progress = classItem.calculateProgress(); %>
                                            <% if (progress === 100) { %>
                                                <span class="status-badge status-completed">
                                                    <i class="fas fa-check-circle mr-2"></i> 
                                                    Đã hoàn thành
                                                </span>
                                            <% } else if (progress === 0) { %>
                                                <span class="status-badge status-upcoming">
                                                    <i class="fas fa-clock mr-2"></i> 
                                                    Sắp bắt đầu
                                                </span>
                                            <% } else { %>
                                                <span class="status-badge status-ongoing pulse-animation">
                                                    <i class="fas fa-play-circle mr-2"></i> 
                                                    Đang diễn ra
                                                </span>
                                            <% } %>
                                        </div>

                                        <!-- Teacher Info -->
                                        <div class="teacher-info">
                                            <div class="teacher-avatar">
                                                <%= classItem.teacher.fullName.charAt(0).toUpperCase() %>
                                            </div>
                                            <div>
                                                <p class="font-semibold text-gray-700">
                                                    <%= classItem.teacher.fullName %>
                                                </p>
                                                <p class="text-sm text-gray-500">Giảng viên</p>
                                            </div>
                                        </div>

                                        <!-- Progress Section -->
                                        <div class="progress-section">
                                            <div class="flex justify-between items-center mb-2">
                                                <span class="text-sm font-semibold text-gray-700">
                                                    Tiến độ khóa học
                                                </span>
                                                <span class="text-sm font-bold text-purple-600">
                                                    <%= progress %>%
                                                </span>
                                            </div>
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: <%= progress %>%"></div>
                                            </div>
                                            <div class="flex justify-between text-xs text-gray-500 mt-2">
                                                <span>
                                                    <i class="fas fa-calendar-alt mr-1"></i>
                                                    <%= new Date(classItem.startDate).toLocaleDateString('vi-VN') %>
                                                </span>
                                                <span>
                                                    <i class="fas fa-flag-checkered mr-1"></i>
                                                    <%= new Date(classItem.endDate).toLocaleDateString('vi-VN') %>
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Class Details -->
                                    <div class="class-details">
                                        <div class="detail-grid">
                                            <div class="detail-item">
                                                <div class="detail-icon icon-calendar">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </div>
                                                <div>
                                                    <p class="text-sm text-gray-500 mb-1">Ngày bắt đầu</p>
                                                    <p class="font-semibold text-gray-800">
                                                        <%= new Date(classItem.startDate).toLocaleDateString('vi-VN') %>
                                                    </p>
                                                </div>
                                            </div>

                                            <div class="detail-item">
                                                <div class="detail-icon icon-end">
                                                    <i class="fas fa-calendar-check"></i>
                                                </div>
                                                <div>
                                                    <p class="text-sm text-gray-500 mb-1">Ngày kết thúc</p>
                                                    <p class="font-semibold text-gray-800">
                                                        <%= new Date(classItem.endDate).toLocaleDateString('vi-VN') %>
                                                    </p>
                                                </div>
                                            </div>

                                            <div class="detail-item">
                                                <div class="detail-icon icon-clock">
                                                    <i class="fas fa-clock"></i>
                                                </div>
                                                <div>
                                                    <p class="text-sm text-gray-500 mb-1">Lịch học</p>
                                                    <p class="font-semibold text-gray-800">
                                                        <%= classItem.schedule.days.join(', ') %>
                                                    </p>
                                                    <p class="text-sm text-gray-600">
                                                        <%= classItem.schedule.time %>
                                                    </p>
                                                </div>
                                            </div>

                                            <div class="detail-item">
                                                <div class="detail-icon icon-users">
                                                    <i class="fas fa-users"></i>
                                                </div>
                                                <div>
                                                    <p class="text-sm text-gray-500 mb-1">Sĩ số</p>
                                                    <p class="font-semibold text-gray-800">
                                                        <%= classItem.students.length %>/<%= classItem.maxStudents %>
                                                    </p>
                                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                                        <div class="bg-purple-500 h-2 rounded-full" 
                                                             style="width: <%= (classItem.students.length / classItem.maxStudents) * 100 %>%"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Enrollment Section -->
                                        <div class="enrollment-section" id="enrollment-section-<%= classItem._id %>">
                                            <% 
                                                const isEnrolled = classItem.students.some(student => 
                                                    student._id.toString() === studentId);
                                                const isPending = classItem.pendingRequests.some(request => 
                                                    request._id.toString() === studentId);
                                            %>

                                            <% if (isEnrolled) { %>
                                                <div class="enrollment-status enrollment-enrolled">
                                                    <div class="flex items-center">
                                                        <i class="fas fa-check-circle mr-3 text-xl"></i>
                                                        <div>
                                                            <p class="font-semibold">Bạn đã tham gia lớp học này</p>
                                                            <p class="text-sm opacity-80">Có thể bắt đầu học ngay</p>
                                                        </div>
                                                    </div>
                                                    <a href="/student/class_student/<%= classItem._id %>" 
                                                       class="btn-enter btn-3d">
                                                        <i class="fas fa-play mr-2"></i>
                                                        Vào học
                                                    </a>
                                                </div>
                                            <% } else if (isPending) { %>
                                                <div class="enrollment-status enrollment-pending">
                                                    <div class="flex items-center">
                                                        <i class="fas fa-clock mr-3 text-xl pulse-animation"></i>
                                                        <div>
                                                            <p class="font-semibold">Yêu cầu tham gia đang chờ duyệt</p>
                                                            <p class="text-sm opacity-80">Giảng viên sẽ xem xét yêu cầu của bạn</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            <% } else { %>
                                                <div class="text-center">
                                                    <button onclick="joinClass('<%= classItem._id %>')"
                                                            class="btn-join btn-3d join-button">
                                                        <i class="fas fa-hand-paper mr-3"></i>
                                                        Tham gia lớp học
                                                    </button>
                                                    
                                                    <div id="rejection-message-<%= classItem._id %>" class="hidden mt-6">
                                                        <div class="enrollment-status enrollment-rejected">
                                                            <div class="flex items-center">
                                                                <i class="fas fa-times-circle mr-3 text-xl"></i>
                                                                <div>
                                                                    <p class="font-semibold">Yêu cầu của bạn đã bị từ chối</p>
                                                                    <p class="text-sm opacity-80">Bạn có thể gửi yêu cầu lại</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <button onclick="joinClass('<%= classItem._id %>')"
                                                                class="btn-join btn-3d mt-4">
                                                            <i class="fas fa-redo mr-3"></i>
                                                            Gửi yêu cầu lại
                                                        </button>
                                                    </div>
                                                </div>
                                            <% } %>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    <% } %>
                </div>
            </main>
        </div>
    </div>

    <%- include('../partials/student_footer') %>

    <script>
        // Initialize animations on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Add staggered animations
            const elements = document.querySelectorAll('.slide-in');
            elements.forEach((el, index) => {
                el.style.animationDelay = `${index * 0.1}s`;
            });

            // Initialize progress bars with animation
            const progressBars = document.querySelectorAll('.progress-fill');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.width = width;
                }, 500);
            });
        });

        // Join class function
        async function joinClass(classId) {
            const button = event.target;
            const originalText = button.innerHTML;
            
            // Show loading state
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-3"></i>Đang gửi yêu cầu...';
            button.disabled = true;
            
            try {
                const response = await fetch(`/student/classes/${classId}/join`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'same-origin'
                });

                const data = await response.json();

                if (response.ok) {
                    // Get the enrollment section
                    const enrollmentSection = document.getElementById(`enrollment-section-${classId}`);
                    
                    // Update UI to show pending status with animation
                    enrollmentSection.innerHTML = `
                        <div class="enrollment-status enrollment-pending slide-in">
                            <div class="flex items-center">
                                <i class="fas fa-clock mr-3 text-xl pulse-animation"></i>
                                <div>
                                    <p class="font-semibold">Yêu cầu tham gia đang chờ duyệt</p>
                                    <p class="text-sm opacity-80">Giảng viên sẽ xem xét yêu cầu của bạn</p>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    showNotification(data.message, 'success');
                } else {
                    // Reset button state
                    button.innerHTML = originalText;
                    button.disabled = false;
                    showNotification(data.message || 'Có lỗi xảy ra khi gửi yêu cầu', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                // Reset button state
                button.innerHTML = originalText;
                button.disabled = false;
                showNotification('Có lỗi xảy ra khi gửi yêu cầu', 'error');
            }
        }

        // Listen for SSE notifications
        const eventSource = new EventSource('/notifications');
        eventSource.onmessage = function(event) {
            const notification = JSON.parse(event.data);
            const classId = notification.classId;
            const enrollmentSection = document.getElementById(`enrollment-section-${classId}`);

            if (notification.type === 'enrollment_approved') {
                if (enrollmentSection) {
                    enrollmentSection.innerHTML = `
                        <div class="enrollment-status enrollment-enrolled slide-in">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle mr-3 text-xl"></i>
                                <div>
                                    <p class="font-semibold">Bạn đã tham gia lớp học này</p>
                                    <p class="text-sm opacity-80">Có thể bắt đầu học ngay</p>
                                </div>
                            </div>
                            <a href="/student/class_student/${classId}" 
                               class="btn-enter btn-3d">
                                <i class="fas fa-play mr-2"></i>
                                Vào học
                            </a>
                        </div>
                    `;
                }
                showNotification('Yêu cầu tham gia lớp học đã được chấp nhận! 🎉', 'success');
            } else if (notification.type === 'enrollment_rejected') {
                if (enrollmentSection) {
                    const rejectionMessage = document.getElementById(`rejection-message-${classId}`);
                    if (rejectionMessage) {
                        rejectionMessage.classList.remove('hidden');
                        rejectionMessage.classList.add('slide-in');
                        const joinButton = enrollmentSection.querySelector('.join-button');
                        if (joinButton) {
                            joinButton.classList.add('hidden');
                        }
                    }
                }
                showNotification('Yêu cầu tham gia lớp học đã bị từ chối', 'error');
            }
        };

        // Enhanced notification function
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} text-xl mr-3"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // Add hover effects for cards
        document.querySelectorAll('.class-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-10px) scale(1.02)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });

        // Add intersection observer for animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        document.querySelectorAll('.slide-in').forEach(el => {
            observer.observe(el);
        });
    </script>
</body>
</html>